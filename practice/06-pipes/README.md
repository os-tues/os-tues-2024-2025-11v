# Работа с файлови дескриптори и канали (pipes)

## Описание на файловете

### **00-introduction.c**
Този файл демонстрира основната употреба на канали (**pipes**) за комуникация между процеси.

- **Описание:**
  - Родителският процес пише съобщение в канала.
  - Дъщерният процес чете съобщението от канала и го принтира.
  - Има пример за използване на блокиращ и неблокиращ режим (чрез `fcntl`).

- **Основни функции:**
  - `pipe()`: Създава канал (pipe) за комуникация.
  - `fork()`: Създава нов процес.
  - `write()`: Записва данни в канала.
  - `read()`: Чете данни от канала.

---

### **01-ls-pipe-grep.c**
Този файл демонстрира използването на канал за свързване на два процеса, изпълняващи различни програми (`ls` и `grep`), чрез пренасочване на стандартния вход и изход.

- **Описание:**
  - Дъщерният процес изпълнява `ls -la`, като изходът му се пренасочва към канала.
  - Родителският процес изпълнява `grep .c`, като входът му се пренасочва към канала.

- **Основни функции:**
  - `dup()`: Дублира файлов дескриптор, за да пренасочи стандартния вход или изход.
  - `execlp()`: Стартира програма (`ls` или `grep`), замествайки текущия процес.

---

### **02-ls-pipe-grep-pipe-cowsay.c**
Този файл демонстрира свързване на три процеса чрез два канала. Това е пример за верижна обработка на данни между процеси.

- **Описание:**
  - Първият процес изпълнява `ls -la` и записва изхода в първия канал.
  - Вторият процес чете от първия канал, изпълнява `grep .c`, и записва резултата във втория канал.
  - Третият процес чете от втория канал и изпълнява `cowsay`, за да покаже резултата в забавен формат.

- **Основни функции:**
  - `pipe()`: Създава два канала за свързване на трите процеса.
  - `dup()`: Пренасочва файловите дескриптори за вход и изход.
  - `execlp()`: Стартира програми (`ls`, `grep`, `cowsay`).

---

## Полезни функции за работа с канали

### **pipe()**
- Създава комуникационен канал между два процеса.
- Аргументи:
  - Масив от два файлови дескриптора: `pipefd[0]` за край за четене и `pipefd[1]` край за писане.
- Пример:
  ```c
  int pipefd[2];
  if (pipe(pipefd) == -1) {
      perror("pipe");
  }

### **dup() и dup2()**
- **Описание**:
  - `dup()` и `dup2()` се използват за дублиране на файлови дескриптори.
  - Когато дублирате файлов дескриптор, новият файлов дескриптор става препратка към същия обект (файл, канал и т.н.) в системната таблица на файлове.
  - Това е полезно за пренасочване на стандартния поток за вход (`STDIN_FILENO`), изход (`STDOUT_FILENO`) или грешки (`STDERR_FILENO`) към друг файлов дескриптор.

- **Как работи**:
  - `dup()`: Дублира даден файлов дескриптор, като използва най-ниския наличен номер в таблицата на файлови дескриптори.
  - `dup2()`: Позволява дублиране на файлов дескриптор в конкретен файлов дескриптор, който се задава като аргумент.

---

### **Пример с обяснение**
Следният код показва как изходът `stdout` се пренасочва към **pipefd[1]** (края за писане на канал):

```c
close(STDOUT_FILENO);      // Затваря стандартния изход (fd = 1) и го освобождава.
dup(pipefd[1]);            // Дублира pipefd[1], като го пренасочва към fd = 1 (STDOUT_FILENO), защото 1 е най-ниският свободен дескриптор (тъй като го освободихме на предишният ред).
close(pipefd[1]);          // Затваря оригиналния pipefd[1], тъй като вече не е нужен.